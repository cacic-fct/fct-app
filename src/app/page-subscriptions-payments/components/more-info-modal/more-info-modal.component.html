<ion-header>
  <ion-toolbar>
    <ion-title>Inscrição</ion-title>
    <ion-buttons slot="start"> <ion-button (click)="closeModal()">Fechar</ion-button> </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ng-container *ngIf="majorEvent$ | async as majorEvent; else loading">
    <div class="event-container">
      <ion-card-header>
        <ion-card-title>{{ majorEvent.name }}</ion-card-title>
      </ion-card-header>

      <ion-card-content *ngIf="majorEvent.description">
        <p class="ion-text-justify event-description">{{ majorEvent.description }}</p>
      </ion-card-content>

      <div class="card-section ion-padding-horizontal">
        <div class="card-label">
          <ion-icon name="calendar-outline" aria-hidden="true"></ion-icon>
          Datas
        </div>

        <ion-item lines="none">
          Evento
          <span slot="end">
            {{ getDateFromTimestamp(majorEvent.eventStartDate) | date: 'dd/MM' }}
            {{ majorEvent.eventEndDate && '- ' + (getDateFromTimestamp(majorEvent.eventEndDate) | date: 'dd/MM') }}
          </span>
        </ion-item>

        <ion-item lines="none" *ngIf="majorEvent.subscriptionStartDate && majorEvent.subscriptionEndDate">
          Inscrição
          <span slot="end">
            {{ getDateFromTimestamp(majorEvent.subscriptionStartDate) | date: 'dd/MM' }}
            {{
              majorEvent.subscriptionEndDate &&
                '- ' + (getDateFromTimestamp(majorEvent.subscriptionEndDate) | date: 'dd/MM')
            }}
          </span>
        </ion-item>
      </div>

      <div class="card-section ion-padding-horizontal" *ngIf="majorEvent.price">
        <div class="card-label">
          <ion-icon name="wallet-outline" aria-hidden="true"></ion-icon>
          Valores
        </div>

        <ng-container *ngIf="majorEvent.price.isFree; else notFree">
          <ion-item lines="none">
            <ion-label>Gratuito</ion-label>
          </ion-item>
        </ng-container>

        <ng-template #notFree>
          <ng-container *ngIf="majorEvent.price.single; then singlePrice; else multiPrice"> </ng-container>
        </ng-template>

        <ng-template #singlePrice>
          <ion-item lines="none">
            Preço único
            <span slot="end">{{ majorEvent.price.single | currency: 'BRL' }}</span>
          </ion-item>
        </ng-template>

        <ng-template #multiPrice>
          <ng-container *ngIf="subscriptionType | async as subsType">
            <ion-item lines="none">
              {{ enrollmentTypes.getEnrollmentType(subsType) }}
              <span slot="end">{{ majorEvent.price[subsType].code | currency: 'BRL' }}</span>
            </ion-item>
          </ng-container>
        </ng-template>
      </div>

      <div class="ion-padding">
        <h2>Inscrito</h2>
        <app-event-list [eventInput$]="subscribedEvents$"></app-event-list>

        <h2>Não inscrito</h2>
        <app-event-list [eventInput$]="notSubscribedEvents$"></app-event-list>
      </div>
    </div>
  </ng-container>

  <ng-template #loading>
    <ion-progress-bar type="indeterminate"></ion-progress-bar>
  </ng-template>

  <ng-template #loadingSpinner>
    <ion-spinner name="dots" style="margin: 0 auto; display: block"></ion-spinner>
  </ng-template>
</ion-content>
