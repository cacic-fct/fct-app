<ion-header>
  <ion-toolbar>
    <ion-title>Adicionar grande evento</ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/area-restrita"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <form [formGroup]="dataForm" (ngSubmit)="onSubmit()">
    <ng-container>
      <ion-card-header>
        <ion-card-title>Informações do evento</ion-card-title>
      </ion-card-header>

      <ion-item>
        <ion-label position="floating">Curso</ion-label>
        <ion-select interface="popover" formControlName="course">
          <ng-container *ngFor="let course of courses | keyvalue">
            <ion-select-option slot="start" class="course" [value]="course.key">
              {{ course.value.name }}
            </ion-select-option>
          </ng-container>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Nome do evento</ion-label>
        <ion-input formControlName="name"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Descrição curta do evento</ion-label>
        <ion-input formControlName="shortDescription"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Descrição do evento</ion-label>
        <ion-input formControlName="description"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Emoji do evento</ion-label>
        <ion-input formControlName="icon"> </ion-input>
      </ion-item>
    </ng-container>

    <ng-container>
      <ion-card-header>
        <ion-card-title>Data do evento</ion-card-title>
      </ion-card-header>

      <ion-item>
        <ion-label>Evento dura mais que um dia</ion-label>
        <ion-toggle
          slot="end"
          formControlName="public"
          [checked]="dateRange"
          (ionChange)="dateRangeChange()"></ion-toggle>
      </ion-item>

      <ion-item>
        <ion-label>Data {{(dateRange$ | async) ? 'do início' : ''}} do evento</ion-label>
        <ion-input
          formControlName="dateStart"
          [value]="dataForm.value.date"
          placeholder="dd/MM/yyyy HH:mm"
          readonly></ion-input>
        <ion-button fill="clear" id="open-date-input">
          <ion-icon icon="calendar"></ion-icon>
        </ion-button>
      </ion-item>

      <ion-item *ngIf="dateRange$ | async">
        <ion-label>Data do fim do evento</ion-label>
        <ion-input
          formControlName="dateEnd"
          [value]="dataForm.value.date"
          placeholder="dd/MM/yyyy HH:mm"
          readonly></ion-input>
        <ion-button fill="clear" id="open-date-end-input">
          <ion-icon icon="calendar"></ion-icon>
        </ion-button>
      </ion-item>
    </ng-container>

    <ng-container>
      <ion-card-header>
        <ion-card-title>Inscrições</ion-card-title>
      </ion-card-header>
      <ion-item>
        <ion-label class="ion-text-wrap">Data do início das inscrições</ion-label>
        <ion-input
          formControlName="dateStart"
          [value]="dataForm.value.date"
          placeholder="dd/MM/yyyy HH:mm"
          readonly></ion-input>
        <ion-button fill="clear" id="open-date-input">
          <ion-icon icon="calendar"></ion-icon>
        </ion-button>
      </ion-item>

      <ion-item>
        <ion-label class="ion-text-wrap">Data do fim das inscrições</ion-label>
        <ion-input
          formControlName="dateStart"
          [value]="dataForm.value.date"
          placeholder="dd/MM/yyyy HH:mm"
          readonly></ion-input>
        <ion-button fill="clear" id="open-date-input">
          <ion-icon icon="calendar"></ion-icon>
        </ion-button>
      </ion-item>
    </ng-container>

    <ng-container>
      <ion-card-header>
        <ion-card-title>Preço</ion-card-title>
      </ion-card-header>

      <ion-item>
        <ion-label>Diferenciar preço por tipo de inscrição</ion-label>
        <ion-toggle slot="end" formControlName="public" (ionChange)="priceDiferentiateChange()"></ion-toggle>
      </ion-item>

      <ng-container *ngIf="(priceDiferentiate$ | async); else noPriceDiferentiation">
        <ion-item>
          <ion-label position="floating">Aluno da Unesp</ion-label>
          <ion-input
            formControlName="priceStudents"
            inputmode="numeric"
            placeholder="Somente números"
            (keypress)="inputNumbersOnly($event)"></ion-input>
          <ion-text slot="end" color="medium"
            ><p>{{ dataForm.value.priceStudents / 100 | currency: 'BRL'}}</p></ion-text
          >
        </ion-item>
        <ion-item>
          <ion-label position="floating">Aluno de outras instituições de ensino superior</ion-label>
          <ion-input
            formControlName="priceOtherStudents"
            inputmode="numeric"
            placeholder="Somente números"
            (keypress)="inputNumbersOnly($event)"></ion-input>
          <ion-text slot="end" color="medium"
            ><p>{{ dataForm.value.priceOtherStudents / 100 | currency: 'BRL'}}</p></ion-text
          >
        </ion-item>
        <ion-item>
          <ion-label position="floating">Professor</ion-label>
          <ion-input
            formControlName="priceProfessors"
            inputmode="numeric"
            placeholder="Somente números"
            (keypress)="inputNumbersOnly($event)"></ion-input>
          <ion-text slot="end" color="medium"
            ><p>{{ dataForm.value.priceProfessors / 100 | currency: 'BRL'}}</p></ion-text
          >
        </ion-item>
      </ng-container>
      <ng-template #noPriceDiferentiation>
        <ion-item>
          <ion-label position="floating">Preço</ion-label>
          <ion-input
            formControlName="price"
            inputmode="numeric"
            placeholder="Somente números"
            (keypress)="inputNumbersOnly($event)"></ion-input>
          <ion-text slot="end" color="medium"><p>{{ dataForm.value.price / 100 | currency: 'BRL'}}</p></ion-text>
        </ion-item>
      </ng-template>
      <ion-card-header>
        <ion-card-title>Informações de pagamento</ion-card-title>
      </ion-card-header>
      <ion-item>
        <ion-label position="floating">Nome completo do beneficiário</ion-label>
        <ion-input formControlName="accountName"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">CPF ou CNPJ</ion-label>
        <ion-input
          formControlName="accountBank"
          placeholder="Somente números"
          inputmode="numeric"
          (keypress)="inputNumbersOnly($event)"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Instituição bancária</ion-label>
        <ion-input formControlName="accountBank" placeholder="Inclua o número do banco"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Agência - Sem dígito verificador</ion-label>
        <ion-input
          formControlName="accountBank"
          placeholder="XXXX"
          inputmode="numeric"
          (keypress)="inputNumbersOnly($event)"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Conta - Com dígito verificador</ion-label>
        <ion-input formControlName="accountBank" placeholder="XXXX-X"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Chave Pix</ion-label>
        <ion-input formControlName="accountChavePix"></ion-input>
      </ion-item>
    </ng-container>

    <ion-card-header>
      <ion-card-title>Botão (opcional)</ion-card-title>
    </ion-card-header>

    <ion-item>
      <ion-label position="floating">Texto (opcional)</ion-label>
      <ion-input formControlName="buttonText"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">Link</ion-label>
      <ion-input formControlName="buttonUrl"></ion-input>
    </ion-item>

    <ion-card-header>
      <ion-card-title>Outras informações (opcional)</ion-card-title>
    </ion-card-header>

    <ion-item>
      <ion-label>Evento aberto ao público</ion-label>
      <ion-toggle slot="end" formControlName="public" checked="off"></ion-toggle>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Criador do evento</ion-label>
      <ion-input value="{{ userData.displayName }}" color="medium" readonly> </ion-input>
    </ion-item>

    <ion-button class="ion-padding-horizontal" id="check-modal" type="submit">Criar evento</ion-button>
    <p style="font-size: 0.75em" class="ion-padding-horizontal">Ao continuar, seu nome será gravado junto ao evento.</p>
  </form>
</ion-content>

<ion-modal trigger="open-date-input" id="modal-date">
  <ng-template>
    <ion-datetime
      #dateInput
      presentation="date-time"
      showDefaultButtons="true"
      (ionChange)="dataForm.value.dateStart = formatDate(dateInput.value)"
      class="margin-horizontal-auto"></ion-datetime>
  </ng-template>
</ion-modal>

<ion-modal trigger="open-date-end-input" id="modal-date">
  <ng-template>
    <ion-datetime
      #dateInput
      presentation="date-time"
      showDefaultButtons="true"
      (ionChange)="dataForm.value.dateEnd = formatDate(dateInput.value)"
      class="margin-horizontal-auto"></ion-datetime>
  </ng-template>
</ion-modal>
