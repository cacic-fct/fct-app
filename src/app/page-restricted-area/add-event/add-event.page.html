<ion-header>
  <ion-toolbar>
    <ion-title>Adicionar evento</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <form [formGroup]="dataForm">
    <ion-card-header>
      <ion-card-title>Informações do evento</ion-card-title>
    </ion-card-header>

    <ion-item>
      <ion-label position="floating">Curso</ion-label>
      <ion-select interface="popover" formControlName="course">
        <ng-container *ngFor="let course of courses | keyvalue">
          <ion-select-option slot="start" class="course" [value]="course.key">
            {{ course.value.name }}
          </ion-select-option>
        </ng-container>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="floating">Nome do evento</ion-label>
      <ion-input formControlName="name"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">Descrição curta do evento</ion-label>
      <ion-input formControlName="shortDescription"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">Descrição do evento</ion-label>
      <ion-input formControlName="description"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">Emoji do evento</ion-label>
      <ion-input formControlName="icon"> </ion-input>
    </ion-item>

    <ion-item>
      <ion-label class="ion-text-wrap">Data do evento</ion-label>
      <ion-datetime-button datetime="eventDate"></ion-datetime-button>
    </ion-item>

    <ion-item>
      <ion-toggle (ionChange)="enableDateEnd = !enableDateEnd"></ion-toggle>
      <ion-label class="ion-text-wrap">Fim do evento</ion-label>
      <ion-datetime-button [disabled]="!enableDateEnd" datetime="eventDateEnd"></ion-datetime-button>
    </ion-item>

    <ion-card-header>
      <ion-card-title>Localização (opcional)</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-item>
        <ion-label position="floating">Predefinição</ion-label>
        <ion-select (ionChange)="placeChange($event)" interface="popover" placeholder="Personalizado" #selectPlace>
          <ng-container *ngFor="let places of places | keyvalue">
            <ion-select-option slot="start" class="course" [value]="places.key">
              {{ places.value.name }}
            </ion-select-option>
          </ng-container>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Endereço ou descrição</ion-label>
        <ion-input formControlName="locationDescription" (ionInput)="placeInputKeyDown()"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Latitude</ion-label>
        <ion-input formControlName="locationLat"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Longitude</ion-label>
        <ion-input formControlName="locationLon"></ion-input>
      </ion-item>
    </ion-card-content>

    <ion-card-header>
      <ion-card-title>Botão (opcional)</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-item>
        <ion-label position="floating">Texto (opcional)</ion-label>
        <ion-input formControlName="buttonText"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Link</ion-label>
        <ion-input formControlName="buttonUrl"></ion-input>
      </ion-item>
    </ion-card-content>

    <ion-card-header>
      <ion-card-title>Outras informações (opcional)</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-item>
        <ion-label position="floating">Código do YouTube</ion-label>
        <ion-input formControlName="youtubeCode" placeholder="Código do vídeo no YouTube"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label>Evento aberto ao público</ion-label>
        <ion-toggle slot="end" formControlName="public" checked="off"></ion-toggle>
      </ion-item>

      <!--
        TODO utilizar observables para recuperar grandes eventos
      <ion-item>
        <ion-label position="floating">Pertence ao grande evento</ion-label>
        <ion-select interface="popover" formControlName="inMajorEvent">
          <ng-container *ngIf="majorEvents.getFutureMajorEvents() | async; let items; else: loading">
            <ng-container *ngFor="let majorEvent of items | keyvalue">
              <ion-select-option slot="start" class="majorEvent" [value]="majorEvent.value.name">
                {{ majorEvent.value.name }}
              </ion-select-option>
            </ng-container>
          </ng-container> 
        </ion-select>
      </ion-item> -->

      <ion-item>
        <ion-label position="stacked">Criador do evento</ion-label>
        <ion-input value="{{ userData.displayName }}" color="medium" readonly> </ion-input>
      </ion-item>
    </ion-card-content>

    <ion-button class="ion-padding-horizontal" id="check-modal" type="submit">Criar evento</ion-button>
    <p style="font-size: 0.75em" class="ion-padding-horizontal">Ao continuar, seu nome será gravado junto ao evento.</p>

    <ion-modal [keepContentsMounted]="true">
      <ng-template>
        <ion-datetime id="eventDate" presentation="date-time" showDefaultButtons="true" formControlName="date">
          <span slot="title">Selecione a data do evento</span>
        </ion-datetime>
      </ng-template>
    </ion-modal>

    <ion-modal [keepContentsMounted]="true">
      <ng-template>
        <ion-datetime id="eventDateEnd" presentation="date-time" showDefaultButtons="true" formControlName="dateEnd">
          <span slot="title">Selecione a data de término do evento</span>
        </ion-datetime>
      </ng-template>
    </ion-modal>
  </form>
</ion-content>

<ion-modal trigger="check-modal" id="modal-check">
  <ng-template>
    <div class="margin-horizontal-auto content-container ion-padding" style="overflow: scroll; width: 100%">
      <img
        class="margin-horizontal-auto"
        style="width: 72px; height: 72px; display: block; padding: 10px"
        [src]="getEmoji(dataForm.value.icon) " />

      <div class="ion-text-center">
        <h1 style="margin: 0">{{ dataForm.value.name }}</h1>
        <h5 style="margin: 0; margin-bottom: 5px; font-weight: 500">{{ dataForm.value.shortDescription }}</h5>
        <h5 style="margin: 0; margin-bottom: 5px; font-weight: 500">{{ getCourse(dataForm.value.course) }}</h5>
        <h4 style="margin: 0; font-weight: 400">
          <!-- prettier-ignore -->
          {{ toUppercase(getDateFromTimestamp(dataForm.value.date) | date: "EEEE, dd 'de' MMMM 'de' y") }}
        </h4>
        <h3 style="margin: 0; font-weight: 400">{{ getDateFromTimestamp(dataForm.value.date) | date: 'HH:mm' }}</h3>
      </div>

      <div *ngIf="dataForm.value.description">
        <h2>Sobre</h2>
        <p>{{ dataForm.value.description }}</p>
      </div>

      <div *ngIf=" dataForm.value.locationDescription || (dataForm.value.locationLat && dataForm.value.locationLon)">
        <h2>Localização</h2>

        <div *ngIf="dataForm.value.locationDescription ">
          <ion-item lines="none">
            <ion-icon name="pin" slot="start"></ion-icon>
            <ion-label class="ion-text-wrap">{{ dataForm.value.locationDescription }}</ion-label>
          </ion-item>
        </div>
      </div>

      <div *ngIf="dataForm.value.buttonText || dataForm.value.buttonUrl">
        <ion-button expand="block" color="primary" [href]="dataForm.value.buttonUrl" target="_blank"
          >{{dataForm.value.buttonText? dataForm.value.buttonText : 'Acompanhe o evento' }}</ion-button
        >
        <p color="medium">URL: {{ dataForm.value.buttonUrl}}</p>
      </div>

      <div *ngIf="dataForm.value.youtubeCode">
        <h2>Transmissão do evento</h2>
        <iframe
          width="400"
          height="225"
          [src]="'https://www.youtube-nocookie.com/embed/' + dataForm.value.youtubeCode | safe: 'resourceUrl'"
          title="YouTube"
          frameborder="0"
          allow="autoplay; clipboard-write; encrypted-media; picture-in-picture"
          allowfullscreen></iframe>
      </div>
    </div>
    <ion-grid style="width: 100%">
      <ion-row>
        <ion-col>
          <ion-button style="width: 100%" fill="clear" (click)="closeModal()"> Fechar </ion-button>
        </ion-col>
        <ion-col>
          <ion-button style="width: 100%" fill="clear" (click)="onSubmit()"> Confirmar </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ng-template>
</ion-modal>
